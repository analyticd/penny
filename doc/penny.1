.TH penny 1

.SH NAME
penny - report on postings in financial ledger

.SH SYNOPSIS
penny [posting filter expression] report name [report options] FILE...

.SH DESCRIPTION

The
.B penny
program prepares reports based upon the
.B postings
in your ledger file. Each transaction has at least two postings. After
.B penny
verifies that your ledger file is
.I balanced
(that is, every posting has debits and credits that are equal)
.B penny
splits each transaction into its component postings. After this point,
.B penny
for the most part deals only with postings, not with transactions.

You may specify a
.I filter expression
that determines which postings are ultimately used for the report. The
filter expression may also contain additional options that perform
tasks other than filtering. For example, you may specify how to
perform text matching (for instance, you may want to use regular
expressions) or you may specify that you want to sort the postings (by
default, they are not sorted and are left in the order in which they
were found in the input ledger).

Next you must specify a
.IR report .
Currently there are two reports: 
.BR postings ,
which shows information about each posting, like a checkbook register, and
.BR balance ,
which shows you information about the balance of each account. The
report is based only upon the postings that the filter expression
returned.

You may then specify options pertaining to the report. The
.BR postings
report takes many options that format its output and that specify
which postings are shown in the report; however, postings that the
filter expression returned that are not shown in the report still
affect the running balance. This can be useful if, for example, you
want to see the total balance in your bank account and how some
transactions affect it but you do not want to see all transactions
since the beginning of time. The
.BR balance
report takes many fewer options.

Finally you may specify one or more files from which to draw the
data. If you do not specify a file, standard input is used.

The report is always printed to standard output. By default,
.BR penny
sees whether its standard output is a terminal. If so,
.BR penny 's
output is sized to fit the width of the
.BR COLUMNS
environment variable (if it is set) and is printed in color. If
standard output is not a terminal, by default the output is not in
color and will be 80 characters wide. This behavior can be overridden
on the command line.

Entering the data into the ledger files is your responsibility;
.B penny
will never modify this data. To see how to enter data into the file,
see the file
.BR docs/samplePennyFile ,
which is included inside the package for
.BR penny-lib .

.SH POSTING FILTERS
.SS Dates

.TP
.B --date cmp timespec, -d cmp timespec

The date of the posting must be within the time frame given.
.BR cmp
is one of
.BR < , > , <= , >= , == , /= , !=
and
.BR date
is either a date alone, such as
.BR 2012-04-25 ,
or a date and a time, such as
.BR "2012-04-25 14:25 -0400" .
You may need to quote some of these arguments; for example,
.BR >
probably has special meaning to your shell and so you will need to
quote it.

.TP
.B --current
Same as
.B --date <= [right now]

.SS Pattern matching

These options allow you to filter postings by specifying a pattern
that must match a particular component of the posting. By default the simple
.I within
matcher is used, and matches are case-insensitive.

.TP
.B -a pattern, --account pattern
The sub-accounts of the account are separated with colons, and the
match succeeds if the pattern matches this entire colon-separated
name.

.TP
.B --account-level num pattern
The account is separated into sub-accounts, which are numbered
beginning at zero. The match succeeds if the posting has a sub-account
numbered at the given level, and if that sub account matches the given
pattern.

.TP
.B --account-any pattern
The account is separated into sub-accounts. The match succeeds if the
pattern matches any of a posting's sub-accounts.

.TP
.B --payee pattern, -p pattern
Succeeds if the pattern matches the posting's payee. If the posting
has no payee, the payee of the parent transaction is used (if there is
one).

.TP
.B --tag pattern, -t pattern
Succeeds if any one of the posting's tags matches the given pattern.

.TP
.B --number pattern
Succeeds if the posting's number matches the given pattern. If the
posting has no number, the number of the parent transaction is used
(if there is one).

.TP
.B --flag pattern
Succeeds if the posting's flag matches the given pattern. If the
posting has no number, the flag of the parent transaction is used
(if there is one).

.TP
.B --commodity pattern
The commodity is separated into colon-separated sub-commodities, and
the test succeeds if the pattern matches the full colon-separated
commodity name.

.TP
.B --commodity-level pattern
The commodity is separated into sub-commodities, which are numbered
beginning at zero. The match succeeds if the posting has a sub-commodity
numbered at the given level, and if that sub-commodity matches the given
pattern.

.TP
.B --commodity-any pattern
The commodity is separated into sub-commodities. The match succeeds if
the pattern matches any of a posting's sub-commodities.

.TP
.B --posting-memo pattern
The posting memo must match the given pattern.

.TP
.B --transaction-memo pattern
The transaction memo must match the given pattern.

.SS Other posting characteristics

.B --debit
The entry must be a debit.

.B --credit
The entry must be a credit.

.B --qty cmp number
The entry's quantity must fall within the given range. Valid values
for cmp are the same as those for --date.

.SS Operators

Each of the options above is a single operand. You can join these
operands together with operators. These operators are specified below,
from highest to lowest precedence. All operators are left
associative. If you specify two adjacent operands without specifying
an operator, penny automatically uses the --and operator.

.TP
.BI --open expr --close
Force precedence using parentheses. Enclose a complete expression
between the
.B --open
and
.B --close
options.

.TP
.BI --not expr
True if
.I expr
is false.

.TP
.IB expr1 --and expr2
True if
.I expr1
and
.I expr2
are both true.

.TP
.IB expr1 --or expr2
True if
.I expr1
or
.I expr2
is true.

.SS Options affecting patterns

These options affect how patterns are interpreted. The order of the
.B penny
command line is significant; each of these options only affects
patterns that appear after it on the command line.

.TP
.B -i, --case-insensitive
Patterns are case insensitive (default)

.TP
.B -I, --case-sensitive
Patterns are case sensitive

.TP
.B --within
Use the "within" matcher, which matches if the pattern given appears
anywhere within the target text. This is a simple letter-for-letter
match, not a regular expression, though its case sensitivity is
affected by the
.B --case-insensitive
and
.B --case-sensitive
options.

.TP
.B --pcre
Use the "pcre" matcher, which uses Perl-compatible regular expressions (see
.BR pcresyntax "(1) and " pcrepattern (1))

.TP
.B --posix
Use the "posix" matcher, which uses POSIX regular expressions (see
.BR regex (7))

.TP
.B --exact
Use the "exact" matcher, which matches if the given pattern is a
letter-for-letter match of the target text, with case sensitivity
determined by the
.B --case-insensitive
and
.B --case-sensitive
options.

.SH Removing postings after sorting and filtering

.TP
.BI "--head " n
Keep only the first
.I n
postings.

.TP
.BI "--tail " n
Keep only the last
.I n
postings.

.SH Sorting

.TP
.BI "--sort " key
.TQ
.BI "-s " key
Sorts postings according to a key. Use multiple
.B --sort
options to sort by more than one key. Valid keys are: payee, date,
flag, number, account, drCr, qty, commodity, postingMemo,
transactionMemo.

The postings are sorted in ascending order if the first letter of the
key is lowercase; descending order if the first letter of the key is
uppercase.

.SS REPORTS

.SS postings report

The
.B postings
report, or
.B pos
for short, shows postings in order with a running balance. This report
takes all the options shown above in the categories from "Posting
filters" to "Removing postings after sorting and filtering." These
options affect which postings are shown in the report. Postings that
are not shown in the report but which were not filtered out in the
filtering stage still affect the report's running balance.

Additional options for the
.B postings
report:

.TP
.BR --color " yes|no|auto|256"
Controls which colors are shown.
.B yes
always shows 8 colors.
.B no
never shows colors.
.B auto
first examines whether standard output is a terminal. If standard output is not a terminal,
.B penny
does not show any colors. If standard output is a terminal, examines
the value of the TERM environment variable. If TERM is
"xterm-256color", uses 256 colors. If TERM is any other value, or if
TERM is not set, uses 8 colors.

.TP
.BR --background " light|dark"
Pick a color scheme for a light or dark terminal background (by
default, a dark color scheme is used.)

.TP
.BI --width " num"
Gives a hint for roughly how wide the report should be, in
columns. Sometimes the report will be narrower than the specified
width; however, it will never be wider than the specified width.

.TP
.BI "--show" " field"
.TQ
.BI "--hide" " field"
Show or hide fields from the displayed report. Fields are displayed in a fixed order. Available fields are:

.TP
.B transaction
A number assigned to each transaction in order from beginning to end,
beginning with zero. This number is assigned before the transactions
are split into postings.

.TP
.B revTransaction
Like
.BR transaction ,
but assigned to each transaction in order from end to beginning.

.TP
.B pre-filter
A number assigned to each posting, beginning with zero, before the
postings are filtered.

.TP
.B revPre-filter
Like
.BR pre-filter ,
but assigned to each posting from end to beginning.

.TP
.B post-sort
A number assigned to each posting, beginning with zero, that remains
